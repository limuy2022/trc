# trc0.2版本基于上一个版本的改进

| 新增功能                        |
|:----------------------------|
| 新增对函数调用的支持                  |
| 加强tdb功能，添加多条指令              |
| 添加项目对高精度整数和高精度小数的支持         |
| 提升了tshell的功能，使其在一定情况下不会终止程序 |
| 增加基础数据结构：map，array，list     |
| ctree文件大小端统一，具备跨平台高级特性      |
| 项目可以跨Linux平台                |
| 提供类，支持面向对象编程                |
| 支持中文和英文多种语言                 |
| 支持多行注释                      |
| 加强grammar工具的功能，使输出更加美观可读    |
| 表达式支持小括号                    |
| 支持utf-8编码                   |
| 增加version指令，用于输出版本号         |
| tdb增加缩写，提高调试效率              |
| 增加111_987_135的整数写法，提高可读性    |
| 添加style工具用于格式化代码            |

| 修复漏洞                          |
|:------------------------------|
| 修复常量折叠漏洞                      |
| 修复token负数解析漏洞                 |
| 修复readfile报错异常                |
| 修复int函数漏洞                     |
| 修复函数调用漏洞                      |
| 修复虚拟机底层类型转化漏洞                 |
| 修复brun,crun,run执行一个文件就解释结束的漏洞 |
| 解决DEL指令变量不存在不报错问题             |
| 修复条件循环跳出整个程序的重大漏洞             |
| 修复token不报错漏洞                  |
| 修复tdb var指令错误                 |
| 修复exit函数调用失败的问题               |
| 修复gramamr模块导致的内存泄漏            |
| 修复赋值漏洞                        |
| 修复语法格式检查漏洞，原本的方式可能导致语法错误未检出   |
| 修复grammar无法报错的问题              |
| 修复工具后缀名更改错误问题                 |
| 修复token的解析符号的漏洞               |
| 修复运算符优先级错误                    |
| 修复程序优先级漏洞                     |
| 修复一处tdb的内存泄漏错误                |
| 修复tshell和源文件不得出现空行的错误         |
| 修复grammar模块中调用层级解析错误的问题       |
| 修复优化时可能会出现的除零错误               |
| 修复单独一行代码报错问题                  |
| 修复循环中出现空行报错问题                 |
| 修复tdb var指令可能误判的错误            |
| 修复tshell出现错误易崩溃问题             |

| 内部调整                                     |
|:-----------------------------------------|
| 由于添加了高精度，所以添加gc功能                        |
| 将check与token合并在一起，节约内存和时间                |
| 建立了内存池和对象池结构，减小内存出现碎片化的概率，对于提高性能有着很大的帮助  |
| 缓解文件过大时内存利用率不够问题                         |
| 设置类型数据(int, bool)的数据缓存                   |
| 改变不同数据类型的储存和运行方式，运用c++多态技术，提升了速度的同时节约了内存 |
| 将大部分运行时检查改为编译时检查，提高运行速度                  |
| 将字节码执行时时间复杂度和函数查找时间复杂度由O(n)改为O(1)        |
| 为适应多线程要求，TRE，CRE被彻底弃用                    |
| 使用基础数据和简单结构替换部分stl程序                     |
| 使用namespace对程序结构进行分层，防止命名冲突              |
| 将部分未命名错误调整到编译时检出                         |
| 尽量使用C语言中的函数和方法来减小文件大小和加快速度               |
| ctree文件字节码由short类型改为unsigned char        |
| 提供符号表，优化变量调用时间复杂度为O(1)                   |
| 创建新一代编译器，速度提高50%，内存占用减少，容错性大大增强          |
| 对项目的各方各面进行了重构，可读性和安全性大大增加                |
| 开始使用多线程，充分利用现代计算机多核优势，加快程序运行             |
| 将用二维数组储存的字节码降维，改为用一维数组储存，节省内存并且提高运行速度    |
| 将输入输出调整为c语言，加快I/O速度                      |
| 将字节码索引由short改为uint16_t，将索引大小扩大一倍         |
| 改变输出中文的方式，使适应面更广，并且降低编译难度                |

| 外部调整                                                   |
|:-------------------------------------------------------|
| 删除tshell的参数调用形式                                        |
| 删除:=运算符                                                |
| 合并run和crun工具为run                                       |
| 改进文档，使它更加细致可读                                          |
| 坚持简洁原则，删除all和clean工具                                   |
| 引入--noline-number-table参数来控制是否生成行号表，如果行号表未生成报错时将无法报出行号 |

注：本次更新比较繁杂，更新时间跨度也非常大，在这个版本中，整个项目有了翻天覆地的变化，并且渐渐趋于成熟
